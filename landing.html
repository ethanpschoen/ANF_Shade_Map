<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Angeles National Forest Shade Map</title>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.8.2/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.8.2/mapbox-gl.css' rel='stylesheet' />
    <script src="https://unpkg.com/mapbox-gl-shadow-simulator/dist/mapbox-gl-shadow-simulator.umd.min.js"></script>

    <style>
        body {
            font-family: 'Lora', Tahoma, Geneva, Verdana, sans-serif; /* Modern font */
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: linear-gradient(135deg, #e0f7fa, #c8e6c9); /* Light gradient background */
        }
        header {
            margin: 30px 0;
            font-size: 40px;
            font-weight: bold;
            text-align: center;
            color: #333;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        .subheading {
            margin-top: 20px;
            font-size: 20px;
            font-weight: 600;
            text-align: center;
            color: #555;
        }
        #map-placeholder {
            width: 90%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .text-box {
            width: 90%;
            margin-top: 20px;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            color: #333;
            line-height: 1.6;
        }
        .text-box h2 {
            color: #00796b; /* Accent color */
            margin-bottom: 10px;
        }
        .text-box p {
            margin-bottom: 15px;
        }
        /* Style for date picker and time slider containers */
        .custom-control-container {
            padding: 10px;
            border-radius: 5px;
            background-color: rgba(255, 255, 255, 0.8);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin: 10px;
            position: absolute;
            z-index: 1000;
        }
        #timeSliderContainer{
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        #datePickerContainer{
            top: 10px;
            right: 10px;
        }
    </style>
</head>
<body>
    <header><u>Angeles National Forest Shade Map</u></header>
    <div id="map-placeholder"></div>
    <div class="subheading">Explore the shaded areas of Angeles National Forest.</div>
    <div class="text-box">
        <h2>About the Map</h2>
        <p>This map visualizes the shaded areas within the Angeles National Forest, providing insights into sun exposure at different times of the day. Use the time slider and date picker to explore the forest's shading patterns.</p>
        <p>The shade data is generated using advanced algorithms and elevation data, allowing you to plan your visit or outdoor activities with detailed information about shaded areas.</p>
    </div>

    <script>
        mapboxgl.accessToken = "pk.eyJ1IjoiZXNjaG9lbiIsImEiOiJjbTdiMmNlZjMwOHd5MmpwdTNiaGJ6eGVuIn0.Y9yNK2bpxmADMIHptRQgPw";

        const bounds = [
            [-118.508, 34.136], // Southwest coordinates
            [-117.414, 34.55]    // Northeast coordinates
        ];

        const map = new mapboxgl.Map({
            container: 'map-placeholder',
            center: [-118.0058, 34.3154], // Angeles National Forest
            zoom: 13,
            style: 'mapbox://styles/mapbox/outdoors-v11', // More nature-focused style
            maxBounds: bounds
        });

        map.on('load', () => {
            const shadeMap = new ShadeMap({
                date: new Date(),
                color: '#01112f',
                opacity: 0.7,
                apiKey: "eyJhbGciOiJIUzI1NiJ9.eyJlbWFpbCI6ImVzY2hvZW5Ab3h5LmVkdSIsImNyZWF0ZWQiOjE3MzgzNzIyNjU3MDIsImlhdCI6MTczODM3MjI2NX0.Q6OYzdDPi2Ky256BaXqFIWUjseVsio9_QboTejYxleI",
                terrainSource: {
                    tileSize: 256,
                    maxZoom: 15,
                    getSourceUrl: ({ x, y, z }) => {
                        return `https://s3.amazonaws.com/elevation-tiles-prod/terrarium/${z}/${x}/${y}.png`
                    },
                    getElevation: ({ r, g, b, a }) => {
                        return (r * 256 + g + b / 256) - 32768
                    }
                },
                debug: (msg) => { console.log(new Date().toISOString(), msg) },
            }).addTo(map);

            shadeMap.setDate(new Date(Date.now() + 1000 * 60 * 60));

            // Add the Date and Time controls
            map.addControl(createDatePicker(map, shadeMap));
            map.addControl(createTimeSlider(map, shadeMap));
        });

        function createTimeSlider(map, shadeMap) {
            // ... (your existing createTimeSlider function)
        }

        function createDatePicker(map, shadeMap) {
            // ... (your existing createDatePicker function)
        }
    </script>
</body>
</html>
